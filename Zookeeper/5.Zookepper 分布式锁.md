

zookeeper规定同一时刻，一个节点只能由一个客户端创建，而watcher机制可以监听节点，一旦节点被删除则触发watcher解除阻塞然后创建节点，利用这两个特征可以使用zookeeper实现分布式锁



### 基于临时节点方案

该方案的逻辑是谁创建成功该节点，谁就持有锁，创建失败的则进行阻塞

![截屏2022-07-26 17.56.53](https://s2.loli.net/2022/07/26/hezjPLFoYnbGatl.png)



该方案的缺点是：每次去竞争锁，都只会有一个线程拿到锁，其他线程没获取到锁时都会监听/lockPath节点，当A线程释放完毕，等待的线程都同时停止阻塞去争抢锁，当线程数庞大时会发生“惊群”现象，zookeeper节点可能会运行缓慢甚至宕机





### 基于临时顺序节点方案

临时顺序节点与临时节点不同的是产生的节点是有序的，利用这一特点，只让当前线程监听上一序号的线程，每次获取锁的时候判断自己的序号是否为最小，最小即获取到锁，执行完毕就删除当前节点继续判断谁为最小序号的节点

![截屏2022-07-26 18.08.35](https://s2.loli.net/2022/07/26/3XZuHcw8I571C9P.png)





### Curator分布式锁

















